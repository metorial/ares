name: Ares E2E Tests

on:
  push:
    branches: [main, feature/**]
    paths:
      - 'service/**'
      - 'clients/**'
      - 'package.json'
      - 'bun.lock'
      - '.github/workflows/ares-e2e-tests.yml'
  pull_request:
    branches: [main]
    paths:
      - 'service/**'
      - 'clients/**'
      - 'package.json'
      - 'bun.lock'

jobs:
  e2e-tests:
    name: Run Ares E2E Tests
    uses: metorial/.github/.github/workflows/reusable-e2e-tests.yml@main
    with:
      service_directory: service
      compose_project_prefix: ares-ci
      compose_profiles: 'infra service'
      wait_services: |
        ares-postgres
        ares-redis
        ares-object-storage
        ares-service
      test_container: ares-service
      test_command: cd /app/service && bun run test -- --mode ci --reporter verbose
